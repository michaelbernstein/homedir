#!/bin/sh

echo "==========================================="
echo "make"
echo "==========================================="
make || exit $?

echo ""
echo "==========================================="
echo "make uImage"
echo "==========================================="
make uImage || exit $?

echo ""
echo "==========================================="
echo "Remounting /boot on device"
echo "==========================================="
echo "mount -o remount,rw /boot; exit" | novaterm

echo ""
echo "==========================================="
echo "Putting new kernel on device"
echo "==========================================="
echo "novacom put file:///boot/uImage-2.6.29-palm-tegra < arch/arm/boot/uImage"
novacom put file:///boot/uImage-2.6.29-palm-tegra < arch/arm/boot/uImage

echo ""
echo "==========================================="
echo "Syncing filesystems on device"
echo "==========================================="
echo "sync; sleep 2; sync; exit" | novaterm

echo ""
echo "Device can now be rebooted"
exit 0
