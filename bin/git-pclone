#!/bin/sh
#
# This program git svn clone's a palm svn module
#
# Copyright (c) 2010 Nick Hurley
#
# This file is licensed under the GPL v2, or a later version
# at the discretion of Junio C Hamano or any other official
# git maintainer.
#

USAGE='[-s|--ignore-submissions] [-b|--ignore-branches] [-f|--foss] module [...]'

# This must be capable of running outside of git directory, so
# the vanilla git-sh-setup should not be used.
NONGIT_OK=Yes
. git-sh-setup

URL_BASE="https://subversion.palm.com/main/nova/"

check_palm_repo()
{
    repo="$1"
    svn ls "${URL_BASE}$TLREPO/$repo" > /dev/null 2>&1
    return $?
}

SUBMISSIONS="--tags=submissions"
BRANCHES="--branches=branches"
TLREPO="palm"

while test $# != 0
do
    case "$1" in
    -s|--ignore-submissions)
        SUBMISSIONS=""
        ;;
    -b|--ignore-branches)
        BRANCHES=""
        ;;
    -f|--foss)
        TLREPO="foss"
        ;;
	--)
	    break
	    ;;
	-*)
	    usage
	    ;;
	*)
	    break
	    ;;
    esac
    shift
done

test $# = 0 && usage

CLI="git svn clone --trunk=trunk $SUBMISSIONS $BRANCHES"

while test $# != 0
do
    REPO="$1"
    if check_palm_repo "$1"
    then
        DEST="$(basename "$1")"
        echo "Checking out $TLREPO/$REPO to $DEST"
        ${CLI} "${URL_BASE}$TLREPO/$REPO" "$DEST"
    else
        echo "Ignoring invalid repository $1"
    fi

    shift
done
