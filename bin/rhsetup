#!/usr/bin/env python

import optparse
import os
import shutil
import sys

__linux_root = os.path.expanduser('~/src/rockhopper/%s')
__git_root = '../../git/.git/%s'
shared = ('branches', 'config', 'hooks', 'info', 'objects', 'refs',
          'packed-refs')

def linux_setup(target):
    new_dir = __linux_root % target
    os.mkdir(new_dir)
    os.chdir(new_dir)
    os.system('git init > /dev/null 2>&1')
    os.chdir('.git')
    for s in shared:
        if os.path.isdir(s):
            shutil.rmtree(s)
        elif os.path.exists(s):
            os.remove(s)
        src = __git_root % s
        os.symlink(src, s)

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print 'Need a target to create!'
        sys.exit(1)

    try:
        linux_setup(sys.argv[1])
    except Exception, e:
        print str(e)
        sys.exit(1)

    sys.exit(0)
